<!DOCTYPE html>
<html lang="en">
  <head>

    <meta charset="utf-8">

    <title>macros and literals</title>

    <meta name="keywords" content="racket,macros">
    <meta name="canonical" href="https://rmculpepper.github.io/blog/2011/09/macros-and-literals">
    <meta rel="alternate" type="application/atom+xml" title="Atom Feed"
          href="/blog/feeds/all.atom.xml">
    <link rel="prev" href="/blog/2011/09/syntax-parse-and-literals">
    <link rel="next" href="/blog/2006/04/macros-parameters-binding-and-reference">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="/blog/favicon.png">
    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/pure-min.css"
          integrity="sha384-oAOxQR6DkCoMliIh8yFnu25d7Eq/PHS21PClpwjOTeU2jRSq11vu66rf90/cZr47"
          crossorigin="anonymous">
    <link rel="stylesheet"
          href="https://unpkg.com/purecss@1.0.1/build/grids-responsive-min.css"
          integrity="sha384-e+NM0rMilIXo+lz6+dXhoHMjd2iTSxNsCHpqkvuSBsAhwMDRF/Wn2QRRNaLxTcN/"
          crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="/blog/css/pure-blog.css">
    <link rel="stylesheet" type="text/css" href="/blog/css/pygments.css">
    <link rel="stylesheet" type="text/css" href="/blog/css/scribble.css">
    <link rel="stylesheet" type="text/css" href="/blog/css/custom.css">

  </head>
  <body>


    <div class="layout pure-g">
      <div class="titlebar pure-u-1">
        <div class="header">
          <h1 class="site-title"><a href="/blog/">One Racketeer</a></h1>

          <h2 class="site-tagline">the blog of Ryan Culpepper</h2>
          <h2 class="site-alt-tagline">
            (blog-of ryanc@racket-lang.org)
          </h2>
          <nav class="nav">
            <ul class="nav-list">
              <li class="nav-item">
                <a class="pure-button" href="/blog/tags/db.html">db</a>
              </li><li class="nav-item">
                     <a class="pure-button" href="/blog/tags/macros.html">macros</a>
                   </li><li class="nav-item">
                          <a class="pure-button" href="/blog/tags/racket.html">racket</a>
                        </li>
            </ul>
          </nav>
        </div>
      </div>
      <div class="content pure-u-1">

        <div class="content-inner">


          <article class="post">
  <header class="post-header">
    <h1 class="post-title">macros and literals</h1>
    <div class="post-meta">
      <div class="authors">By: Ryan Culpepper</div>
      <span class="post-date"><time datetime="2011-09-07">2011-09-07</time></span>
      <span class="post-tags"><a href="/blog/tags/racket.html">racket</a>, <a href="/blog/tags/macros.html">macros</a></span>
    </div>
  </header>
  <p>Macros often have associated auxiliary identifiers (sometimes called
<span style="font-style: italic">keywords</span> or <span style="font-style: italic">reserved words</span>, although both terms are
problematic in Racket). For example, <span class="RktSym"><a class="RktStxLink Sq" data-pltdoc="x" href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._cond%29%29">cond</a></span> has <span class="RktSym"><a class="RktStxLink Sq" data-pltdoc="x" href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._else%29%29">else</a></span>;
<span class="RktSym"><a class="RktStxLink Sq" data-pltdoc="x" href="https://docs.racket-lang.org/reference/createclass.html#%28form._%28%28lib._racket%2Fprivate%2Fclass-internal..rkt%29._class%29%29">class</a></span> has <span class="RktSym"><a class="RktStxLink Sq" data-pltdoc="x" href="https://docs.racket-lang.org/reference/createclass.html#%28form._%28%28lib._racket%2Fprivate%2Fclass-internal..rkt%29._public%29%29">public</a></span>, <span class="RktSym"><a class="RktStxLink Sq" data-pltdoc="x" href="https://docs.racket-lang.org/reference/createclass.html#%28form._%28%28lib._racket%2Fprivate%2Fclass-internal..rkt%29._private%29%29">private</a></span>, etc;
<span class="RktSym"><a class="RktStxLink Sq" data-pltdoc="x" href="https://docs.racket-lang.org/reference/creatingunits.html#%28form._%28%28lib._racket%2Funit..rkt%29._unit%29%29">unit</a></span> has <span class="RktSym"><a class="RktStxLink Sq" data-pltdoc="x" href="https://docs.racket-lang.org/reference/creatingunits.html#%28form._%28%28lib._racket%2Funit..rkt%29._import%29%29">import</a></span> and <span class="RktSym"><a class="RktStxLink Sq" data-pltdoc="x" href="https://docs.racket-lang.org/reference/creatingunits.html#%28form._%28%28lib._racket%2Funit..rkt%29._export%29%29">export</a></span>.</p>
<p>The fundamental question is what constitutes a use of an auxiliary
identifier, and there are two reasonable answers: <span style="font-style: italic">symbolic
equality</span> and <span style="font-style: italic">referential equality</span>. By symbolic equality I
mean, for example, that any identifier written with exactly the
letters <span class="stt">else</span> is accepted as an <span class="RktSym"><a class="RktStxLink Sq" data-pltdoc="x" href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._else%29%29">else</a></span> auxiliary form. By
referential equality I mean any identifier that <span style="font-style: italic">refers to</span>
(using the standard notions of binding, environments, etc) the binding
identified as the <span class="RktSym"><a class="RktStxLink Sq" data-pltdoc="x" href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._else%29%29">else</a></span> binding.</p>
<p>The advantage of symbolic equality is its simplicity. The problem is
that it conflicts with other kinds of terms. The most common use of
auxiliary identifiers is to distinguish special sub-forms that require
special interpretation from standard forms such as expressions or
definitions. For example, the first sub-term of a <span class="RktSym"><a class="RktStxLink Sq" data-pltdoc="x" href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._cond%29%29">cond</a></span> clause
is either the auxiliary <span class="RktSym"><a class="RktStxLink Sq" data-pltdoc="x" href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._else%29%29">else</a></span> or an expression; a class-body
form is either a <span class="RktSym"><a class="RktStxLink Sq" data-pltdoc="x" href="https://docs.racket-lang.org/reference/createclass.html#%28form._%28%28lib._racket%2Fprivate%2Fclass-internal..rkt%29._public%29%29">public</a></span> form, a <span class="RktSym"><a class="RktStxLink Sq" data-pltdoc="x" href="https://docs.racket-lang.org/reference/createclass.html#%28form._%28%28lib._racket%2Fprivate%2Fclass-internal..rkt%29._private%29%29">private</a></span> form, ...,
or a definition or expression. But a variable can be named
<span class="RktSym"><a class="RktStxLink Sq" data-pltdoc="x" href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._else%29%29">else</a></span>, and a function can be named <span class="RktSym"><a class="RktStxLink Sq" data-pltdoc="x" href="https://docs.racket-lang.org/reference/createclass.html#%28form._%28%28lib._racket%2Fprivate%2Fclass-internal..rkt%29._private%29%29">private</a></span>... except
that with symbolic auxiliaries, in some contexts a reference to such a
variable or function will be given a drastically different
interpretation, just because of its <span style="font-style: italic">name</span>.</p>
<p>We like to think that names don&rsquo;t matter, as long as they&rsquo;re used
consistently and don&rsquo;t collide with other names in use. And,
crucially, our notion of <span style="font-style: italic">collision</span> is based on
<span style="font-style: italic">binding</span>. The problem with symbolic auxiliaries is that they are
ghosts; they don&rsquo;t collide with other bindings, but they still change
the interpretation of an identifier in some contexts (but not others).</p>
<p>The alternative is referential auxiliaries, in which the special
interpretation of the auxiliary identifier is tied to a binding. The
virtue of this approach is that it relies on the standard mechanisms
of scoping. An identifier cannot refer to <span style="font-style: italic">both</span> a variable
binding and the <span class="RktSym"><a class="RktStxLink Sq" data-pltdoc="x" href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._else%29%29">else</a></span> auxiliary in the same scope. Having a
dedicated binding means the notion of <span class="RktSym"><a class="RktStxLink Sq" data-pltdoc="x" href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._else%29%29">else</a></span> has an existence
more concrete than just &ldquo;a special interpretation that <span class="RktSym"><a class="RktStxLink Sq" data-pltdoc="x" href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._cond%29%29">cond</a></span>
gives to identifiers spelled a certain way&rdquo;; one consequence is that
<span class="RktSym"><a class="RktStxLink Sq" data-pltdoc="x" href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._else%29%29">else</a></span> can be documented using Racket&rsquo;s binding-based
documentation system.</p>
<p>Auxiliary bindings collide like (and with) ordinary bindings, and
these collisions can be resolved using standard namespace management
tools such as import renaming (<span class="RktSym"><a class="RktStxLink Sq" data-pltdoc="x" href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._rename-in%29%29">rename-in</a></span>). Alas, there is
no way to protect a referential auxiliary identifier from being
shadowed, but at least with it behaves consistently: shadow
<span class="RktSym"><a class="RktStxLink Sq" data-pltdoc="x" href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._else%29%29">else</a></span> and it no longer acts like <span class="RktSym"><a class="RktStxLink Sq" data-pltdoc="x" href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._else%29%29">else</a></span>, but
after all, shadow <span class="RktSym"><a class="RktStxLink Sq" data-pltdoc="x" href="https://docs.racket-lang.org/reference/lambda.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._lambda%29%29">lambda</a></span> and it no longer acts like
<span class="RktSym"><a class="RktStxLink Sq" data-pltdoc="x" href="https://docs.racket-lang.org/reference/lambda.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._lambda%29%29">lambda</a></span>. I do wish there were a way to mark certain names
unshadowable, though; I think it would be a net win for usability.</p>
<p>(Note that all of these arguments in favor of referential auxiliary
identifiers also apply to syntax-parameters as a superior alternative
to unhygienic binding. See
<a href="/blog/2006/04/macros-parameters-binding-and-reference">my old blog
post on the subject</a>.)</p>
<p>Scheme uses referential equality for macro &ldquo;literals lists&rdquo; (used to
recognize auxiliary identifiers). Unfortunately, it allows literals
that don&rsquo;t refer to any binding, creating another kind of ghostly
identifier interpretation: it collides with nothing but can be
overridden by any other binding that comes along.</p>
<p>When I created <span class="RktSym"><a class="RktStxLink Sq" data-pltdoc="x" href="https://docs.racket-lang.org/syntax/Parsing_Syntax.html#%28form._%28%28lib._syntax%2Fparse..rkt%29._syntax-parse%29%29">syntax-parse</a></span>, I made it an error to
specify a literal identifier that had no corresponding binding. This
has its own difficulties, however, which I will describe in a separate
post.</p>
  <footer>
    <nav class="post-navigation" aria-label="Post Navigation">
  <div class="pure-menu">
  <ul class="pure-menu-list">
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="/blog/2011/09/syntax-parse-and-literals"
         aria-label="Previous">
        <span aria-hidden="true">&larr; syntax-parse and literals</span>
      </a>
    </li>
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="/blog/2006/04/macros-parameters-binding-and-reference"
         aria-label="Next">
        <span aria-hidden="true">macros, parameters; binding, and reference &rarr;</span>
      </a>
    </li>
  </ul>
  </div>
</nav>
  </footer>
</article>


        </div>
        <div class="page-copyright">
          <div class="page-copyright-icon">
            <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
              <img alt="Creative Commons License" style="border-width:0"
                   src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a>
          </div>
          <div class="page-copyright-text">
            Copyright 2011 Ryan Culpepper.
            This work is licensed under a
            <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
            Creative Commons Attribution-ShareAlike 4.0 International License</a>.
          </div>
        </div>
      </div>
    </div>

  </body>
</html>